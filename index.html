<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live EMG Data</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>

<h2>Live EMG Data from ESP32</h2>
<canvas id="emgChart" width="400" height="200"></canvas>

<script>
    const broker = "ws://192.168.1.10:1883";  // Local MQTT Broker IP (use WebSockets)
    const topic = "esp32/emg";  // Topic to subscribe to for EMG data

    let emgData = [];
    let labels = [];

    // MQTT Client Setup
    const client = mqtt.connect(broker);

    client.on("connect", function () {
        console.log("Connected to MQTT Broker");
        client.subscribe(topic); // Subscribe to the EMG topic
    });

    client.on("message", function (receivedTopic, message) {
        if (receivedTopic === topic) {
            let emgValue = parseFloat(message.toString());
            console.log("Received EMG Data:", emgValue);
            updateChart(emgValue);
        }
    });

    // Chart.js Setup
    const ctx = document.getElementById("emgChart").getContext("2d");
    const chart = new Chart(ctx, {
        type: "line",
        data: {
            labels: labels,
            datasets: [{
                label: "EMG Signal",
                data: emgData,
                borderColor: "red",
                borderWidth: 2,
                fill: false
            }]
        },
        options: {
            scales: {
                x: { display: false },
                y: { min: 0, max: 100 }
            }
        }
    });

    // Update chart with new data
    function updateChart(emgValue) {
        let timestamp = new Date().toISOString();
        
        // Keep data length under 50 points
        if (labels.length >= 50) {
            labels.shift();
            emgData.shift();
        }

        labels.push(timestamp);
        emgData.push(emgValue);
        chart.update();
    }
</script>

</body>
</html>
